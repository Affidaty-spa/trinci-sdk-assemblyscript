# Change Log

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](http://keepachangelog.com/)
and this project adheres to [Semantic Versioning](http://semver.org/).

## [3.0.2] - 2024-06-03

### Added
- `setError()` and `getErrorMessage()` method to sdk.MsgPack

### Changed
- `sdk.MsgPack.errorMessage()` deprecated

## [3.0.1] - 2024-03-14

### Changed
- fixed broken import in boilerplate/transformer.mjs

## [3.0.0] - 2024-03-13

### Added
- "@publicMethod" decorator. It's used instead of "methodsMap" to mark method as callable from a transaction. For more info refer to documentation and examples in "assembly/index.ts" file.
- "publish:info" npm script. It prints smart constract and publisher info without actually submmitting publish transaction to the blockchain
- fields inside a @msgpackable class can now be decorated with @optional to define optional values which can be omitted in transaction arguments. If omittted in transaction, an optional field assumes default value;
- added a section describing usage of publish utility to wiki
- added utilities as publish, init and relay as npx executable commands (`trinci-sdk-init`, `trinci-sdk-publish`, `trinci-sdk-sock-relay`)

### Changed
- No more need to define "alloc", "run" and "is_callable" functions in assembly/index.ts. They get added by transformer automatically during compilation process. It is, however, possible to define custom ones which won't be overwritten. only signature check will be done on custom functions.
- (De)serialization using a @msgpackable class of transaction args containing extra fields or missing one or more field will now give a deserialization faillure error
- executing  "npm run publishh:mainnet" now tries to actually submit the publish transaction to the TRINCI mainnet
- changed example "assembly/index.ts" file to use new decorators
- general overhaul of some function names for (hopefully) better readability. Logic is still pretty much the same. Refer to the documentation (both wiki and generated) for more info.

## [2.6.0] - 2023-10-04

### Added
- Added a way to connect test suite node to a real TRINCI node via `.connectToBlockchain()` method. Used only for cloning. No data/transaction gets sent to the remote TRINCI node.
- Added a way to clone an account (data and assets) from remote TRINCI node via `.cloneRemoteAccount()` and `.cloneRemoteAccountWithContract()` methods.
    Connect to a TRINCI node with `.connectToBlockchain()` method before cloning.
- Cloned account data get stored into an internal cache to be used in case of subsequent cloning of the same account.
- `.clearRemoteAccountsCache()` method completely empties the cache. Passing an accountId to that method clears only the relative accounts cache (if any).
- `.restoreAccountFromCache()` method to restore an account to the state saved in cache(if any).

### Fixed
- If an exception is thrown for `hf_s_call` or `hf_call` an appropriate error message is displayed instead of "method not found"

## [2.5.6] - 2023-05-22

### Added
- `node.db.printAccountData('<accId>')` and `node.db.printAccountAssets('<accId>')` methods in jest test environment;
- `node.setTime()` and `node.getTime()`;

## [2.5.5] - 2023-03-20

### Fixed
- fixed u8ArrayFromMem() error when trying to free zero bytes

### Changed
- 'publish' npm script renamed in 'pre-publish'

## [2.5.4] - 2023-03-20

### Fixed
- WasmResult.fromBytes()

## [2.5.3] - 2023-03-16

### Fixed
- links in wiki

## [2.5.2] - 2023-03-16

### Fixed
- links in `readme.md`

## [2.5.1] - 2023-03-16

### Fixed
- Jest test suite fixes
- example smart contract errors

## [2.5.0] - 2023-03-16

### Added
- Added wiki and autogenerated documentation to repo

### Changed
- DB class:
    - removed `balance()`, `getDataFromOwnerDB()` and replaced with more generic `getAccountAssetPacked()` and `getAccountDataPacked()`
    - added `setAccountAssetPacked()` and `setAccountDataPacked()`
- `Utils.stringtoU8Array()` function renamed to `Utils.stringToU8Array()`
- jsdoc comments update
- visitor-as update
- AssemblyScript version update

## [2.4.3] - 2022-11-07

### Changed
- Slightly better publication script management.
- More verbose messagges in publish script

## [2.4.2] - 2022-11-02

### Fixed
- removed unnecessary console.log().

## [2.4.1] - 2022-10-31

### Fixed
- fixed hf_s_call() host functions.

## [2.4.0] - 2022-10-31

### Added

- SDK now works with assemblyscript v0.20.0 to v0.21.7
- `serializeInternalType<>()` and `deserializeInternalType<>()` functions to easily (de)serialize internal assemblyscript types (`bool`, `u8`, `i8`, `u16`, `i16`, `u32`, `i32`, `u64`, `i64`, `f32`, `f64`, `string`, `ArrayBuffer`) and arrays of those types.
- added possibility to test compiled smart contracts(.wasm) directly with jest without need to set up a full TRINCI node.
- added a sample jest test for sample smart contract. Try it with `npm run test` after compiling example smart contract with `npm run asbuild`.
- account class for better account data management.
- methods for node db exploration.
- new Host functions supported: hf_s_call, hf_emit, is_callable. hf_verify, hf_get_block_time, hf_remove_asset
- BulkTX simulation
- js script for smart contract publication in blockchain ("utils" directory). Run it with "--help" to get usage help.
- added EventEmitter no node simulator, which fires events emitted by smart contracts(node.EventEmitter.on('txEvent', ()=>{}))
- added SocketRelay to simulate node socket connection. Launch it before test and do ```node.connectToSocket('<relayInterface>', <relayPort>);``` in your jest test to relay all emitted events as if you were connected to a real TRINCI node. Then you'll be able to connect with your software to that relay as if it was a real TRINCI node with socket connection. Launch it with "utils/socketRelay.js --help" to get help.

### Changed

- host functions are now expected to be imported in "env" namespace instead of "hostfunctions"

### Fixed
- node db visualization functions fixed.

## [2.3.6] - 2022-03-14

### Added

- sdk.Return namespace containing some helper functions for easy creation of various smart contract responces.
- sdk.Response namespace with some smart contract responces management functions.
- Functions for (de)serialization of various primitives(and their arrays) added to MsgPack namespace.
- loadDataT<>(), storeDataT<>(), loadAssetT<>(), storeAssetT<>() added to HostFunctions namespace

## [2.3.2] - 2022-02-28

### Added

- publish utility.

## [2.3.1] - 2022-02-18

### Added

- arrayBufferToHexString() utility function.

## [2.3.0] - 2022-02-18

### Added

- drand() host function.
- getAccountContract() host function.

## [2.2.1] - 2022-01-13

### Changed

- Changed sdk import in boilerplate code.

## [2.2.0] - 2021-12-02

### Added

- Added HostFunctions.getKeys().
- Added HostFunctions.emit().

## [2.1.2] - 2021-11-25

### Changed

- License changed.

### Added

- License, changelog and readme files added to npm package.

## [2.1.1] - 2021-11-22

### Added

- Added default export along single components exports.

## [2.1.0] - 2021-11-17

### Added

- Added HostFunctions.sha256() function.

## [2.0.5] - 2021-11-10

### Fixed

- MsgPack.appOutputEncode() first arg type changed to bool instead of 'boolean'.

## [2.0.4] - 2021-11-03

### Fixed

- msgpack.ts parentheses fix.

## [2.0.3] - 2021-11-02

### Fixed

- public key serialization fix.

## [2.0.2] - 2021-11-02

### Fixed

- boilerplate dependencies fixed.

## [2.0.1] - 2021-10-29

### Changed

- my_alloc() function renamed to alloc() as expected by trinci-core v0.2.1.

## [2.0.0] - 2021-10-21

### Changed

- HostFunctions.call() now returns a named structure (Types.AppOutput) instead of raw bytes.